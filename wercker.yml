test:
  box: amane/lualatex-latexmk:latest
  steps:
    - script:
        name: test document (FYI)
        code: |
          redpen-runner ./${WERCKER_GIT_BRANCH}/main.tex || true

build:
  box: amane/lualatex-latexmk:latest
  steps:
    - script:
        name: load cache
        code: |
          mkdir -p $WERCKER_CACHE_DIR/cache/font
          mkdir -p /root/.texlive2018/texmf-var/luatexja/
          find $WERCKER_CACHE_DIR/cache/font -type f -exec cp -v {} /root/.texlive2018/texmf-var/luatexja/ \;
    - script:
        name: compile document
        code: |
          ./script/make_story_list.sh
          latexmk
          cp build/book.pdf ${WERCKER_REPORT_ARTIFACTS_DIR}/
    - script:
        name: save cache
        code: |
          find /root/.texlive2018/texmf-var/luatexja/ -type f -exec cp -v {} $WERCKER_CACHE_DIR/cache/font/ \;
