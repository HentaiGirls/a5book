test:
  box: amane/lualatex-latexmk:latest
  steps:
    - script:
        name: test document (FYI)
        code: |
          redpen-runner ./${WERCKER_GIT_BRANCH}/main.tex || true

build:
  box: amane/lualatex-latexmk:latest
  steps:
    - script:
        name: load cache
        code: |
          mkdir -p $WERCKER_CACHE_DIR/cache/font
          mkdir -p /root/.texlive2018/texmf-var/luatexja/
          cp "$WERCKER_CACHE_DIR/cache/font/*" /root/.texlive2018/texmf-var/luatexja/
    - script:
        name: compile document
        code: |
          ./script/make_story_list.sh
          latexmk
          cp build/book.pdf ${WERCKER_REPORT_ARTIFACTS_DIR}/
    - script:
        name: save cache
        code: |
          cp "/root/.texlive2018/texmf-var/luatexja/*" $WERCKER_CACHE_DIR/cache/font/
